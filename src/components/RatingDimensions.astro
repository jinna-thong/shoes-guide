---
/**
 * RatingDimensions Component
 * Displays multi-dimensional editor ratings with progress bars
 * Based on Uma's hi-fi mockups and Figma template
 */

interface EditorRatingDimensions {
  comfort?: number;
  ride_performance?: number;
  durability?: number;
  value?: number;
  traction_grip?: number;
}

interface Props {
  dimensions?: EditorRatingDimensions;
  overall_rating?: number;
  locale?: 'en' | 'th';
}

const {
  dimensions,
  overall_rating,
  locale = 'en'
} = Astro.props;

// Dimension labels
const dimensionLabels: Record<string, { th: string; en: string }> = {
  comfort: { th: 'ความสบาย', en: 'Comfort' },
  ride_performance: { th: 'ประสิทธิภาพ', en: 'Performance' },
  durability: { th: 'ความทนทาน', en: 'Durability' },
  value: { th: 'คุ้มค่า', en: 'Value' },
  traction_grip: { th: 'ความยึดเกาะ', en: 'Traction' },
};

// Get gradient color based on score
function getGradientClass(score: number): string {
  if (score >= 4.0) return 'from-green-400 to-green-500';
  if (score >= 3.0) return 'from-yellow-400 to-green-400';
  if (score >= 2.0) return 'from-orange-400 to-yellow-400';
  return 'from-red-400 to-orange-400';
}

// Generate stars for overall rating
function generateStars(rating: number) {
  const fullStars = Math.floor(rating);
  const hasHalfStar = (rating % 1) >= 0.5;
  const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
  return { fullStars, hasHalfStar, emptyStars };
}

const hasContent = dimensions && Object.keys(dimensions).length > 0;
const stars = overall_rating ? generateStars(overall_rating) : null;
---

<div class="rating-dimensions bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
  <h3 class="font-bold text-lg mb-4 flex items-center gap-2 text-gray-900">
    <svg class="h-5 w-5 text-amber-500" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
    </svg>
    {locale === 'th' ? 'คะแนนรายด้าน' : 'Rating Dimensions'}
  </h3>

  {/* Overall Rating with Stars */}
  {overall_rating && stars && (
    <div class="mb-6 pb-4 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <span class="text-sm text-gray-600">
          {locale === 'th' ? 'คะแนนรวม' : 'Overall Rating'}
        </span>
        <div class="flex items-center gap-2">
          <div class="flex items-center gap-0.5">
            {/* Full Stars */}
            {Array(stars.fullStars).fill(0).map(() => (
              <svg class="h-5 w-5 fill-amber-400 text-amber-400" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            ))}
            {/* Half Star */}
            {stars.hasHalfStar && (
              <svg class="h-5 w-5" viewBox="0 0 24 24">
                <defs>
                  <linearGradient id="halfStar">
                    <stop offset="50%" stop-color="#FBBF24"/>
                    <stop offset="50%" stop-color="#E5E7EB"/>
                  </linearGradient>
                </defs>
                <path fill="url(#halfStar)" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            )}
            {/* Empty Stars */}
            {Array(stars.emptyStars).fill(0).map(() => (
              <svg class="h-5 w-5 fill-gray-200 text-gray-200" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            ))}
          </div>
          <span class="text-xl font-bold text-gray-900">{overall_rating.toFixed(1)}</span>
        </div>
      </div>
    </div>
  )}

  {hasContent ? (
    <div class="space-y-4">
      {Object.entries(dimensions || {}).map(([key, rating]) => {
        const label = dimensionLabels[key];
        const displayLabel = label ? (locale === 'th' ? label.th : label.en) : key;
        const percentage = (rating as number / 5) * 100;
        const gradientClass = getGradientClass(rating as number);

        return (
          <div class="rating-row">
            <div class="flex items-center justify-between mb-1">
              <span class="text-sm font-medium text-gray-700">{displayLabel}</span>
              <span class="text-sm font-bold text-gray-900">{(rating as number).toFixed(1)}</span>
            </div>
            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
              <div
                class={`h-full bg-gradient-to-r ${gradientClass} rounded-full transition-all duration-500`}
                style={`width: ${percentage}%`}
              />
            </div>
          </div>
        );
      })}
    </div>
  ) : (
    <div class="text-center py-4">
      <div class="flex justify-center gap-1 mb-3 opacity-50">
        {Array(5).fill(0).map(() => (
          <svg class="h-6 w-6 fill-gray-300" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        ))}
      </div>
      <p class="text-sm text-gray-500">
        {locale === 'th' ? 'ยังไม่มีคะแนน' : 'Not yet rated'}
      </p>
      <p class="text-xs text-gray-400 mt-1">
        {locale === 'th' ? 'กำลังทดสอบสินค้า' : 'Our editors are testing this product'}
      </p>
    </div>
  )}
</div>

<style>
  .rating-row {
    transition: transform 0.2s ease;
  }
  .rating-row:hover {
    transform: translateX(4px);
  }
  .rating-dimensions {
    transition: box-shadow 0.2s ease;
  }
  .rating-dimensions:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }
</style>
