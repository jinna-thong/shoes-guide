---
/**
 * E3-S04: Categories Hub Page
 * Lists all shoe categories with product counts
 * Bilingual EN/TH support
 */

import { getAllCategories } from '../../lib/db';
import Layout from '../../layouts/Layout.astro';

const categories = await getAllCategories();

// Category metadata for display
const categoryInfo: Record<string, { description: string; icon: string }> = {
  'Road Running': {
    description: 'Built for pavement and hard surfaces. Lightweight with responsive cushioning for daily training and racing.',
    icon: 'road'
  },
  'Trail Running': {
    description: 'Designed for off-road terrain. Features aggressive traction and protective elements for rough conditions.',
    icon: 'mountain'
  },
  'Racing': {
    description: 'Lightweight competition shoes optimized for speed. Often feature carbon plates for energy return.',
    icon: 'zap'
  },
  'Daily Trainer': {
    description: 'Versatile shoes for everyday training. Balance of cushioning, durability, and comfort for high mileage.',
    icon: 'calendar'
  },
  'Stability': {
    description: 'Support for overpronators. Features guide rails or medial posts to control excess foot motion.',
    icon: 'shield'
  }
};

const totalProducts = categories.reduce((sum, c) => sum + c.product_count, 0);

// Icon components
function getIcon(type: string) {
  switch(type) {
    case 'road':
      return `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />`;
    case 'mountain':
      return `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14" />`;
    case 'zap':
      return `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />`;
    case 'calendar':
      return `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />`;
    case 'shield':
      return `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />`;
    default:
      return `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />`;
  }
}
---

<Layout title="Categories" description="Browse running shoes by category">
  <main class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-4">Running Shoe Categories</h1>
      <p class="text-gray-600">
        {categories.length} categories with {totalProducts} products to explore
      </p>
    </div>

    <!-- Category Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {categories.map((category) => {
        const info = categoryInfo[category.category] || { description: '', icon: 'default' };
        const slug = category.category.toLowerCase().replace(/ /g, '-');

        return (
          <a
            href={`/category/${slug}`}
            class="group block bg-white border rounded-xl overflow-hidden hover:shadow-lg hover:border-blue-300 transition"
          >
            <!-- Category Image/Banner -->
            <div class="h-32 bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center relative overflow-hidden">
              <div class="absolute inset-0 opacity-10">
                <svg class="w-full h-full" viewBox="0 0 100 100" fill="currentColor">
                  <circle cx="20" cy="20" r="10" />
                  <circle cx="80" cy="30" r="15" />
                  <circle cx="50" cy="70" r="12" />
                </svg>
              </div>
              <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" set:html={getIcon(info.icon)} />
            </div>

            <!-- Category Info -->
            <div class="p-6">
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-xl font-bold group-hover:text-blue-600 transition">
                  {category.category}
                </h3>
                <span class="px-2 py-1 rounded-full bg-gray-100 text-sm text-gray-600">
                  {category.product_count}
                </span>
              </div>

              {info.description && (
                <p class="text-sm text-gray-600 line-clamp-2">
                  {info.description}
                </p>
              )}

              <div class="mt-4 flex items-center justify-between">
                <span class="text-sm text-gray-500">
                  {category.product_count} products
                </span>
                <span class="text-sm text-blue-600 group-hover:underline flex items-center gap-1">
                  Browse
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </span>
              </div>
            </div>
          </a>
        );
      })}
    </div>

    <!-- Empty State -->
    {categories.length === 0 && (
      <div class="text-center py-12 text-gray-500">
        <p>No categories found.</p>
      </div>
    )}
  </main>
</Layout>
